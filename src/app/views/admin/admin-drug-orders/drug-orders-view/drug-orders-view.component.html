<mat-tab-group>
    <mat-tab label="Info">
        <div class="container-fluid details">
          <ng-container *ngIf="orderDetails; else noOrderDetails">
                <div class="row">
                    <div class="col-md-4">
                            <h5 class="mb-3">Order : #{{orderDetails.order_number + '  ('+orderDetails.order_number_text+')'}}</h5>
                            <p class="mb-1"><strong class="mr-2">Created Date  : </strong>{{orderDetails.order_created_datetime | date:'MM/dd/yyyy'}}</p>
                            <p class="mb-1"><strong class="mr-2">Completed Date : </strong>{{orderDetails.order_completed_datetime | date:'MM/dd/yyyy'}}</p>
                            <p>
                                <strong class="mr-2">System Status: </strong>
                                <span class="m-0" [innerHTML]="_drugOrderHelper.getSystemStausDrugOrder(orderDetails.system_status)"></span>
                            </p>
                    </div>
                    <div class="col-md-4">
                       <h5 class="mb-3">Patient Details</h5>
                        <h6 class="mb-2">{{patient.first_name}} {{patient.last_name}}</h6>
                        <p class="mb-1"><strong> DOB:  </strong>{{patient.dob_formatted }} | Age: {{patient.age}}</p>
                        <p class="mb-0"><strong>Email: </strong>{{patient.email}}</p>
                        <p class="mb-0"><strong>Phone: </strong>{{patient.cell_phone_number | mask: '(000) 000-0000'}}</p>
                    </div>

                    <div class="col-md-4">
                        <h5 class="mb-3">Shipping Address</h5>
                        <div *ngIf="orderDetails.address">
                            <p class="mb-0">{{orderDetails.address.address_line_1?orderDetails.address.address_line_1:''}}{{ orderDetails.address.address_line_2 ? ', ':'' }}<br/>{{orderDetails.address?.address_line_2}}</p>
                            <p class="mb-0">{{orderDetails.address.city_name?orderDetails.address.city_name:''}}{{orderDetails.address.state_name?', '+orderDetails.address.state_name:''}} {{orderDetails.address.zip_code?orderDetails.address.zip_code:''}}</p>
                        </div>
                        <div *ngIf="!orderDetails.address">
                            <p class="mb-0">Address not added yet.</p>
                        </div>
                        <div class="text-500" *ngIf="orderDetails.is_express_shipping!=1"><strong> Shipping Method : </strong>FREE USPS First Class</div>
                        <div class="text-500" *ngIf="orderDetails.is_express_shipping==1"><strong> Shipping Method : </strong>USPS Priority Mail</div>
                        <button *ngIf="showChangeAddressBtn" class="btn btn-warning btn-sm" type="button" (click)="openEditAddressModal()"><i class="fa fa-pencil mr-2"></i>Change Address</button>
                    </div>
                </div>

                <div class="d-flex flex-row justify-content-end align-items-center  mt-2">
                    <button type="button" class="btn btn-sm btn-success" (click)="downloadReceipt('billing_statement')"><i class="mr-2 fa fa-download"></i>Billing Statement</button>
                    <button type="button" *ngIf="anyDrugRefunded" class="btn btn-sm btn-primary" (click)="downloadReceipt('refund_receipt')"><i class="mr-2 fa fa-download"></i>Refund Receipt</button>
                    <button type="button" class="btn btn-sm btn-danger mr-2" (click)="openRefundModal()" *ngIf="!(orderDetails.system_status == 'REFUND_PROCESSED' || orderDetails.system_status == 'REFUND_REQUESTED')"><i class="fa fa-redo mr-2"></i>Refund</button>
                </div>

                <div class="row mt-3">

                    <div class="col-md-12">
                            <div class="table-responsive">
                               <table class="table border-bottom table-sm table-borderless">
                                  <thead class="thead-light">
                                  <tr>
                                      <th class="border-0">Products</th>
                                      <th class="border-0 text-center">Quantity</th>
                                      <th class="border-0 text-center">Prescription Detail</th>
                                      <th class="border-0 text-center">Subscription</th>
                                      <th class="border-0 text-center">Drug Status</th>
                                        <th class="border-0 text-right">Tax</th>
                                        <th class="border-0 text-right">Amount</th>
                                  </tr>
                                  </thead>
                                  <tbody>
                                  <tr *ngFor="let drug of orderDetails.drugs">
                                      <td class="align-middle">
                                      <h6 class="mb-0 text-nowrap font-weight-bold">{{drug.drug_name}} {{ drug.drug_dosage }}
                                          <span *ngIf="drug.product_type=='LENS'">{{ ' - '+drug.eye_type }}</span>
                                      </h6>
                                      </td>
                                      <td class="align-middle text-center">{{drug.drug_quantity+'  '+drug.drug_form}}</td>
                                      <td class="align-middle text-center">
                                            <strong [innerHTML]="_drugOrderHelper.getOrderDrugCustomerOption(drug.customer_drug_option)"></strong>

                                            <a *ngIf="drug.contact_lens_rx_request_url" target="_blank" class="btn btn-sm btn-primary my-2" [href]="drug.contact_lens_rx_request_url">Prescription Request</a>

                                            <div class="mt-2" *ngIf="drug.customer_drug_option == 'PRESCRIPTION_FROM_OTHER_PHARMACY'">
                                                <p class="font-weight-bold">Pharamcy Details</p>
                                                <p class="mb-0">{{drug.transfer_pharmacy_details.store_name}}</p>
                                                <p class="mb-0">{{drug.transfer_pharmacy_details.pharmacy_address_line1+','}}{{drug.transfer_pharmacy_details.pharmacy_address_line2 ? drug.transfer_pharmacy_details.pharmacy_address_line2+',':''}}</p>
                                                <p class="mb-0">{{drug.transfer_pharmacy_details.pharmacy_address_city}} , {{drug.transfer_pharmacy_details.pharmacy_address_state}} - {{drug.transfer_pharmacy_details.pharmacy_address_zipcode}}</p>
                                                <p class="mb-0">Phone: {{drug.transfer_pharmacy_details.pharmacy_phone?drug.transfer_pharmacy_details.pharmacy_phone:'-'}}</p>
                                                <p class="mb-0">Fax: {{drug.transfer_pharmacy_details.pharmacy_fax?drug.transfer_pharmacy_details.pharmacy_fax:'-'}}</p>
                                                <div *ngIf="drug.transfer_pharmacy_prescription_image">
                                                    <app-image-preview [imgPath]="drug.transfer_pharmacy_prescription_image" height="250" width="350"></app-image-preview>
                                                </div>
                                            </div>

                                            <div class="mt-2" *ngIf="drug.customer_drug_option == 'PRESCRIPTION_FROM_DOCTOR' || drug.customer_drug_option == 'MANUALLY_ENTER_PRESCRIPTION'">
                                                <p class="font-weight-bold">Physician Details</p>
                                                <p class="mb-0">{{drug.doctor_details.first_name+' '+drug.doctor_details.last_name}}</p>
                                                <p class="mb-0">{{drug.doctor_details.address_1+','}}{{drug.doctor_details.address_2?drug.doctor_details.address_2+',':''}}</p>
                                                <p class="mb-0"> {{drug.doctor_details.city_name}},{{drug.doctor_details.state_name}} - {{drug.doctor_details.postal_code}}</p>
                                                <p class="mb-0">Phone: {{drug.doctor_details.telephone_number?drug.doctor_details.telephone_number:'-'}} </p>
                                                <p class="mb-0">Fax: {{drug.doctor_details.fax_number?drug.doctor_details.fax_number:'-'}} </p>
                                            </div>

                                            <div *ngIf="drug.customer_drug_option == 'HAVE_PHYSICAL_PRESCRIPTION' && drug.physicial_prescription_image">
                                                <app-image-preview [imgPath]="drug.physicial_prescription_image" height="250" width="250" caption="Prescription"></app-image-preview>
                                            </div>
                                            <div *ngIf="drug.customer_drug_option == 'NO_PRESCRIPTION_REQUIRED'">
                                                No Prescription Required
                                            </div>
                                            <div *ngIf="drug.customer_drug_option == 'PRESCRIPTION_ALREADY_SENT_TO_TELEDADDY_PHARMACY'">
                                                Prescription Already Sent to Teledaddy Pharamcy
                                            </div>
                                            <div class="mt-2" *ngIf="drug.customer_drug_option == 'MANUALLY_ENTER_PRESCRIPTION'">
                                                <div class="d-flex">
                                                    <div class="flex-1" *ngIf="drug.eye_type=='Left Eye (OS)'">
                                                        <p class="font-weight-bold">Left Eye </p>
                                                        <p class="mb-0" *ngIf="drug.manual_prescription_details && drug.manual_prescription_details.left_eye_power">POWER/SPH : {{drug.manual_prescription_details.left_eye_power}}</p>
                                                        <p class="mb-0" *ngIf="drug.manual_prescription_details && drug.manual_prescription_details.left_eye_basecurve">BC : {{drug.manual_prescription_details.left_eye_basecurve}}</p>
                                                        <p class="mb-0" *ngIf="drug.manual_prescription_details && drug.manual_prescription_details.left_eye_diameter">DIA : {{drug.manual_prescription_details.left_eye_diameter}}</p>
                                                        <p class="mb-0" *ngIf="drug.manual_prescription_details && drug.manual_prescription_details.left_eye_cylinder">CYL : {{drug.manual_prescription_details.left_eye_cylinder}}</p>
                                                        <p class="mb-0" *ngIf="drug.manual_prescription_details && drug.manual_prescription_details.left_eye_axis">AXIS : {{drug.manual_prescription_details.left_eye_axis}}</p>
                                                    </div>
                                                    <div class="flex-1"  *ngIf="drug.eye_type=='Right Eye (OD)'">
                                                        <p class="font-weight-bold">Right Eye </p>
                                                        <p class="mb-0" *ngIf="drug.manual_prescription_details && drug.manual_prescription_details.right_eye_power">POWER/SPH : {{drug.manual_prescription_details.right_eye_power}}</p>
                                                        <p class="mb-0" *ngIf="drug.manual_prescription_details && drug.manual_prescription_details.right_eye_basecurve">BC : {{drug.manual_prescription_details.right_eye_basecurve}}</p>
                                                        <p class="mb-0" *ngIf="drug.manual_prescription_details && drug.manual_prescription_details.right_eye_diameter">DIA : {{drug.manual_prescription_details.right_eye_diameter}}</p>
                                                        <p class="mb-0" *ngIf="drug.manual_prescription_details && drug.manual_prescription_details.right_eye_cylinder">CYL : {{drug.manual_prescription_details.right_eye_cylinder}}</p>
                                                        <p class="mb-0" *ngIf="drug.manual_prescription_details && drug.manual_prescription_details.right_eye_axis">AXIS : {{drug.manual_prescription_details.right_eye_axis}}</p>
                                                    </div>
                                                </div>
                                                <div *ngIf="drug.manual_prescription_image">
                                                    <app-image-preview [imgPath]="drug.manual_prescription_image" height="250" width="350"></app-image-preview>
                                                </div>
                                            </div>

                                      </td>
                                      <td class="align-middle text-center font-weight-bold">
                                        <p [ngClass]="{'mb-0':true,'text-success':drug.auto_schedule==1,'text-danger':drug.auto_schedule!=1}">{{drug.auto_schedule==1?'YES':'NO'}}</p>
                                      </td>
                                      <td class="align-middle text-center">
                                            <strong [innerHTML]="_drugOrderHelper.getOrderDrugStatus(drug.order_drug_status)"></strong>

                                            <p class="mt-1 mb-0 font-weight-normal text-success" *ngIf="drug.order_drug_status=='SHIPPED'">Shipped on : {{drug.shipped_on | date: 'MM/dd/yyyy HH:mm a' }}</p>
                                            <p class="mt-1 mb-0 font-weight-normal text-success" *ngIf="drug.order_drug_status=='SHIPPED'">Tracking Id  : <a target="_blank" class="text-primary" [href]="drug.tracking_url">{{ drug.tracking_id }}</a></p>
                                            <button  *ngIf="drug.order_drug_status=='SHIPPED' && drug.label_url" class="btn btn-sm btn-primary" type="button" (click)="openShippingLabelToPrint(drug.label_url)">View Shipping Label</button>

                                            <p class="mt-1 mb-0 font-weight-normal text-success" *ngIf="drug.order_drug_status=='PICKED_UP'">Pickedup on : {{drug.pickedup_on | date: 'MM/dd/yyyy HH:mm a' }}</p>
                                            <p class="mt-1 mb-0 font-weight-normal text-danger" *ngIf="drug.order_drug_status=='REFUND_REQUESTED'">Date time : {{drug.refund_requested_on | date: 'MM/dd/yyyy HH:mm a' }}</p>
                                            <p class="mt-1 mb-0 font-weight-normal text-danger" *ngIf="drug.order_drug_status=='REFUND_PROCESSED'">Date time : {{drug.refund_processed_on | date: 'MM/dd/yyyy HH:mm a' }}</p>
                                            <p class="mb-0 font-weight-normal text-danger" *ngIf="drug.order_drug_status=='REFUND_REQUESTED' || drug.order_drug_status=='REFUND_PROCESSED'">Reason : {{drug.refund_reason}}</p>

                                      </td>
                                      <td class="align-middle text-right">{{ drug.tax_amount | currency:'INR'}}</td>
                                      <td class="align-middle text-right">
                                       <p class="mb-0 font-weight-bold">{{ drug.drug_quantity_price | currency:'INR'}}</p>
                                       <div *ngIf="drug.offer_applied">
                                         <p  class="mb-0 text-muted"><s>{{ drug.drug_quantity_original_price | currency:'INR'}}</s></p>
                                         <a  class="text-decoration-none" [routerLink]="'/admin/offers/view-offer/'+drug.offer_applied"><span class="badge badge-danger p-2 badge-pill"><i class="fa fa-tag mr-2" aria-hidden="true"></i>OFFER {{ drug.offer_amount?(drug.offer_amount| currency:'INR'): drug.offer_percentage+'%'}} DISCOUNT</span></a>
                                       </div>
                                      </td>

                                  </tr>
                                  </tbody>
                              </table>
                            </div>

                            <div class="row no-gutters justify-content-end">
                                <div class="col-auto">
                                    <table class="table table-sm table-borderless text-right">
                                    <tbody>
                                     <tr>
                                        <th class="text-900">Sales Tax</th>
                                        <td class="font-weight-semi-bold text-right">{{(orderDetails.tax_amount||0) | currency:'INR'}}</td>
                                    </tr>
                                    <tr *ngIf="orderDetails.first_order_offer_discount>0">
                                        <th class="text-900 text-danger">First Order Offer Discount</th>
                                        <td class="font-weight-semi-bold text-danger text-right">{{(orderDetails.first_order_offer_discount||0) | currency:'INR'}}</td>
                                    </tr>
                                    <tr>
                                        <th [ngClass]="{'text-900':true,'text-danger':orderDetails.coupon_discount>0?true:false}">Coupon Discount {{ orderDetails.coupon_details && orderDetails.coupon_details.coupon_code?'( Coupon Code Used : '+orderDetails.coupon_details.coupon_code+' )':'' }}</th>
                                        <td [ngClass]="{'font-weight-semi-bold text-right':true,'text-danger':orderDetails.coupon_discount>0?true:false}">{{(orderDetails.coupon_discount||0) | currency:'INR'}}</td>
                                    </tr>
                                    <tr>
                                        <th [ngClass]="{'text-900':true,'text-danger':orderDetails.referral_discount>0?true:false}">Referral Discount {{ orderDetails.referral_code_details ? '( Referral Code Used : '+orderDetails.referral_code_details.referral_code+' )':''}}</th>
                                        <td [ngClass]="{'font-weight-semi-bold text-right':true,'text-danger':orderDetails.referral_discount>0?true:false}">{{(orderDetails.referral_discount||0) | currency:'INR'}}</td>
                                    </tr>
                                    <tr>
                                         <th [ngClass]="{'text-900':true,'text-danger':orderDetails.shipping_charge>0?true:false}">Shipping Charges</th>
                                         <td [ngClass]="{'font-weight-semi-bold text-right':true,'text-danger':orderDetails.shipping_charge>0?true:false}">{{(orderDetails.shipping_charge || 0) | currency:'INR' }}</td>
                                    </tr>
                                    <tr class="border-top">
                                        <th class="font-weight-bold">Total</th>
                                        <td class="font-weight-bold text-right">{{orderDetails.total_amount | currency:'INR' }}</td>
                                    </tr>
                                    </tbody>
                                    </table>
                                </div>
                            </div>

                            <div class="table-responsive">
                                <table class="table border-bottom table-borderless table-sm">
                                    <thead class="thead-light">
                                        <tr>
                                            <th>Charged From Stripe</th>
                                            <th>Charged From Wallet</th>
                                            <th class="text-right">Total</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>
                                             <p class="font-weight-bold">{{orderDetails.charged_from_stripe | currency:'INR' }}</p>
                                             <div class="media" *ngIf="orderDetails.payment && orderDetails.payment.details && orderDetails.payment.details.card">
                                                <div class="media-body">
                                                    <h6 class="mb-0">{{orderDetails.payment.details.card.brand.toUpperCase()}}</h6>
                                                    <p class="mb-0">**** **** **** {{orderDetails.payment.details.card.last4 + ' (Expires : '+orderDetails.payment.details.card.exp_month+'/'+orderDetails.payment.details.card.exp_year+')'}}</p>
                                                </div>
                                            </div>
                                            <a *ngIf="orderDetails.payment && orderDetails.payment.receipt_url" class="btn btn-sm btn-primary" target="_blank" [href]="orderDetails.payment.receipt_url">Stripe Receipt</a>
                                            </td>
                                            <td class="font-weight-bold">{{orderDetails.charged_from_wallet | currency:'INR' }}</td>
                                            <td class="font-weight-bold text-right">{{orderDetails.total_amount | currency:'INR'}}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="table-responsive" *ngIf="orderDetails.refunded_total > 0">
                                <table class="table border-bottom table-borderless table-sm">
                                    <thead class="thead-light">
                                        <tr>
                                            <th>Refunded to Stripe</th>
                                            <th>Refunded to Wallet</th>
                                            <th class="text-right">Refunded Total</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="font-weight-bold">{{orderDetails.refunded_in_stripe | currency:'INR' }}</td>
                                            <td class="font-weight-bold">{{orderDetails.refunded_in_wallet | currency:'INR' }}</td>
                                            <td class="font-weight-bold text-right">{{orderDetails.refunded_total | currency:'INR'}}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <h5 class="mt-3">All Payment Transactions</h5>
                            <div class="table-responsive" *ngIf="orderDetails.all_payment_transactions">
                                <table class="table table-sm">
                                    <thead class="thead-light">
                                        <tr>
                                            <th>#</th>
                                            <th>Transaction Type</th>
                                            <th>Payment Source</th>
                                            <th>Amount Charged</th>
                                            <th>Charge Id</th>
                                            <th>Amount Refund</th>
                                            <th>Refund Id</th>
                                            <th>Datetime</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr [ngClass]="{'alert-success':transaction.transaction_type=='CHARGE'}" *ngFor="let transaction of orderDetails.all_payment_transactions;let i=index;">
                                            <td>{{i+1}}</td>
                                            <td>{{transaction.transaction_type}}</td>
                                            <td>{{transaction.payment_source}}</td>
                                            <td>{{transaction.charged_amount | currency:'INR'}}</td>
                                            <td>
                                               <a *ngIf="transaction.payment_source=='STRIPE'" target="_blank" href="https://dashboard.stripe.com/payments/{{transaction.charge_id}}">{{transaction.charge_id}}</a>
                                               <span *ngIf="transaction.payment_source=='WALLET'">{{'Wallet Transaction #'+transaction.charge_id}}</span>
                                            </td>
                                            <td>{{transaction.refunded_amount | currency:'INR'}}</td>
                                            <td>
                                               <span *ngIf="transaction.refund_id && transaction.payment_source=='STRIPE'">{{transaction.refund_id}}</span>
                                               <span *ngIf="transaction.refund_id && transaction.payment_source=='WALLET'">{{'Wallet Transaction #'+transaction.refund_id}}</span>
                                            </td>
                                            <td>{{transaction.created_at | date:'MM/dd/yyyy HH:mm a'}}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <div class="table-responsive">
                                <table class="table table-sm">
                                    <thead class="thead-light">
                                        <tr>
                                            <th>Customer Status</th>
                                            <th>Technician Status</th>
                                            <th>Pharmacy Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td><p class="m-0" [innerHTML]="_drugOrderHelper.getCustomerStausDrugOrder(orderDetails.customer_status)"></p></td>
                                            <td><p class="m-0" [innerHTML]="_drugOrderHelper.getTechnicianStatusDrugOrder(orderDetails.technician_status)"></p></td>
                                            <td>
                                                <p class="m-0" [innerHTML]="_drugOrderHelper.getPharmacyStatusDrugOrder(orderDetails.pharmacy_status)"></p>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                 <p class="mb-1"><strong class="mr-2">Created Date  : </strong>{{orderDetails.order_created_datetime | date:'MM/dd/yyyy'}}</p>
                                            </td>
                                            <td>

                                            </td>
                                            <td>
                                                <p class="mb-1"><strong class="mr-2">Completed Date : </strong>{{orderDetails.order_completed_datetime | date:'MM/dd/yyyy'}}</p>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td></td>
                                            <td></td>
                                            <td>
                                                <ng-container *ngIf="orderDetails.assigned_to_pharmacy_id && orderDetails.pharmacy_details">
                                                     <p class="mb-1"><strong class="mr-2">Name : </strong>{{orderDetails.pharmacy_details.pharmacy_name}}</p>
                                                     <p class="mb-1"><strong class="mr-2">Phone: </strong>{{orderDetails.pharmacy_details.phone_number | mask: '(000) 000-0000' || '-'}}</p>
                                                     <p class="mb-1"><strong class="mr-2">Fax: </strong>{{orderDetails.pharmacy_details.fax_number | mask: '(000) 000-0000' || '-'}}</p>
                                                     <p class="mb-1"><strong class="mr-2">NPI Number: </strong>{{orderDetails.pharmacy_details.npi_number}}</p>
                                                     <p class="mb-1"><strong class="mr-2">DEA Number: </strong>{{orderDetails.pharmacy_details.dea_number}}</p>
                                                </ng-container>
                                                <div class="mt-4"  *ngIf="orderDetails.transferred_pharmacy">
                                                    <p class="font-weight-bold text-warning">Transferred Pharmacy</p>
                                                    <ng-container>
                                                        <p class="mb-1"><strong class="mr-2">Name : </strong>{{orderDetails.transferred_pharmacy.pharmacy_name}}</p>
                                                        <p class="mb-1"><strong class="mr-2">Pharmacist: </strong>{{orderDetails.transferred_pharmacy.contact_name }}</p>
                                                        <p class="mb-1"><strong class="mr-2">Address: </strong>
                                                            {{orderDetails.transferred_pharmacy.address_line_1 }}
                                                            <span *ngIf="orderDetails.transferred_pharmacy.address_line_1">,<br/></span>
                                                            {{orderDetails.transferred_pharmacy.address_line_2 }}
                                                            <span *ngIf="orderDetails.transferred_pharmacy.address_line_2">,<br/></span>
                                                            {{orderDetails.transferred_pharmacy.city }}
                                                            <span *ngIf="orderDetails.transferred_pharmacy.city">,</span>
                                                            {{orderDetails.transferred_pharmacy.state }}
                                                            <span  *ngIf="orderDetails.transferred_pharmacy.state">,</span>
                                                            {{orderDetails.transferred_pharmacy.zip }}
                                                        </p>

                                                        <p class="mb-1" *ngIf="orderDetails.transferred_pharmacy.phone_number"><strong class="mr-2">Phone: </strong>{{orderDetails.transferred_pharmacy.phone_number | mask: '(000) 000-0000' || '-'}}</p>
                                                        <p class="mb-1" *ngIf="orderDetails.transferred_pharmacy.fax_number"><strong class="mr-2">Fax: </strong>{{orderDetails.transferred_pharmacy.fax_number | mask: '(000) 000-0000' || '-'}}</p>
                                                        <p class="mb-1" *ngIf="orderDetails.transferred_pharmacy.npi_number"><strong class="mr-2">NPI Number: </strong>{{orderDetails.transferred_pharmacy.npi_number}}</p>
                                                        <p class="mb-1" *ngIf="orderDetails.transferred_pharmacy.dea_number"><strong class="mr-2">DEA Number: </strong>{{orderDetails.transferred_pharmacy.dea_number}}</p>
                                                        <p class="mb-1" *ngIf="orderDetails.transferred_pharmacy.ncpdp"><strong class="mr-2">NCPDP Number: </strong>{{orderDetails.transferred_pharmacy.ncpdp}}</p>
                                                    </ng-container>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                    </div>
                </div>
          </ng-container>
            <ng-template #noOrderDetails>
                <div class="text-center text-muted">
                    <h2><i class="fa fa-info-circle"></i></h2>
                    <h4>No Order Details!</h4>
                </div>
            </ng-template>
        </div>
    </mat-tab>
    <mat-tab label="Patient">
        <div class="container-fluid details">
            <ng-container *ngIf="patient; else noDetails ">
                <div class="row">
                    <div class="col-md-6">
                        <h3>Patient Details</h3>
                    </div>
                    <div class="col-md-6">
                         <a href="javascript:void(0);" class="link" (click)="gotoPatientDetails()"><h5># {{patientUinqueNumber}}</h5></a>
                    </div>
                </div>
                <hr>
                <div class="row">
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <label>First Name</label>
                        <h5>{{patient.first_name}}</h5>
                    </div>
                    <div class="col-md-6">
                        <label>Last Name</label>
                        <h5>{{patient.last_name}}</h5>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <label>Gender</label>
                        <h5>{{patient.gender==1?"Male":"Female"}}</h5>
                    </div>
                    <div class="col-md-6">
                        <label>Date Of Birth</label>
                        <h5>{{patient.dob_formatted  || '-'}} <br> Age: {{patient.age}}</h5>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <label>Email</label>
                        <h5>{{patient.email}}</h5>
                    </div>
                    <div class="col-md-6">
                        <label>Mobile No</label>
                        <h5>{{patient.cell_phone_number | mask: '(000) 000-0000'}}</h5>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <label>Shipping Addresses</label>
                        <h5 class="m-0">{{orderDetails.address.address_line_1?orderDetails.address.address_line_1:''}}{{orderDetails.address.address_line_2 ? ', ' + orderDetails.address.address_line_2:''}}</h5>
                        <h5 class="m-0">{{orderDetails.address.city_name?orderDetails.address.city_name:''}}{{orderDetails.address.state_name?', '+orderDetails.address.state_name:''}} {{orderDetails.address.zip_code?orderDetails.address.zip_code:''}}
                        </h5>

                        <button class="btn btn-primary" (click)="loadMapIframe()" data-toggle="collapse" data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">View Shipping Address on Map<i class="ml-2 fa fa-map-marker" aria-hidden="true"></i></button>
                        <div class="collapse" id="collapseExample">
                            <iframe #mapIframe style="display: none;" width="100%" height="450" frameborder="0" style="border:0" allowfullscreen></iframe>
                        </div>
                    </div>
                    <div class="col-md-6">

                    <div>
                        <label>Body Mass Index (latest)</label>
                        <h5>Weight : {{patient.profile_bmi? patient.profile_bmi.weight +' lbs':'-' }}</h5>
                        <h5>Height : {{patient.profile_bmi? patient.profile_bmi.height_feet+' Feet  '+patient.profile_bmi.height_inch+' Inch' : ' - '}}</h5>
                        <h5>BMI    : {{patient.profile_bmi ? patient.profile_bmi.bmi : ' - ' }} <span *ngIf="patient.profile_bmi" [innerHtml]="helper.getBMITextBadge(patient.profile_bmi.bmi_text)"></span></h5>

                    </div>

                        <label>Blood Pressure (latest)</label>
                        <h5> {{patient.profile_bp ?  patient.profile_bp.systolic+' / '+patient.profile_bp.diastolic +' '+ patient.profile_bp.unit  : ' - '}} <span *ngIf="patient.profile_bp" [innerHtml]="helper.getBPTextBadge(patient.profile_bp.result)"></span></h5>

                        <label>Mean Arterial Pressure (latest)</label>
                        <h5>{{patient.profile_bp ?  patient.profile_bp.mean_arterial_pressure +' '+ patient.profile_bp.unit  : ' - '}}</h5>

                        <label>Pulse Pressure(latest)</label>
                        <h5>{{patient.profile_bp ?  patient.profile_bp.pulse_pressure +' '+ patient.profile_bp.unit  : ' - '}}</h5>

                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="accordion td-accordian mt-4" id="licenseAccordian">
                            <div class="card">
                                <div class="card-header" id="headingTwo">
                                    <h3 class="mb-0">
                                        <button class="btn btn-link waves-effect waves-light" type="button" data-toggle="collapse" data-target="#license" aria-expanded="true" aria-controls="collapseTwo">License</button>
                                    </h3>
                                </div>
                                <div id="license" class="collapse show" aria-labelledby="headingTwo" data-parent="#licenseAccordian">
                                    <div class="card-body">
                                        <div class="mt-2">
                                            <div class="allergies">
                                                <app-image-preview *ngIf="profileLicense && profileLicense.license_photo" [imgPath]="profileLicense.license_photo" height="250" width="350" caption="License Image"></app-image-preview>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="accordion td-accordian mt-4" id="fullFaceAccordian">
                            <div class="card">
                                <div class="card-header" id="headingTwo">
                                    <h3 class="mb-0"><button class="btn btn-link waves-effect waves-light" type="button" data-toggle="collapse" data-target="#license" aria-expanded="true" aria-controls="collapseTwo">Full Face Image</button></h3>
                                </div>
                                <div id="license" class="collapse show" aria-labelledby="headingTwo" data-parent="#fullFaceAccordian">
                                    <div class="card-body">
                                        <div class="mt-2">
                                            <div class="allergies">
                                                <app-image-preview  *ngIf="profileLicense && profileLicense.profile_photo" [imgPath]="profileLicense.profile_photo" height="250" width="350" caption="Full Face Image"></app-image-preview>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </ng-container>
            <ng-template #noDetails>
                <div class="text-center text-muted">
                    <h2><i class="fa fa-info-circle"></i></h2>
                    <h4>No Details!</h4>
                </div>
            </ng-template>
        </div>
    </mat-tab>
    <mat-tab label="Subscriptions" *ngIf="orderDetails">
        <div *ngIf="userSubscriptions.length>0">
          <button class="btn btn-sm btn-primary float-right" type="button" (click)="openCreateRefillOrderModal()">Create Refill Order</button>
        </div>
        <div class="container-fluid details">
             <div class="table-responsive">
                  <table class="table">
                    <thead class="thead-light">
                        <tr>
                            <th>RxDrug</th>
                            <th>Refill Count</th>
                            <th>Refill Duration</th>
                            <th>Amount To Charge</th>
                            <th>Next Refill Date</th>
                            <th>Subscription Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr  *ngFor="let subscription of orderDetails.subscription_details">
                          <td>{{subscription.drug_name+' '+subscription.drug_dosage+' '+subscription.subscription_quantity+' '+subscription.drug_form}}
                              <span *ngIf="subscription.product_type=='LENS'">{{ ' - '+subscription.eye_type }}</span>
                          </td>
                          <td>
                              <div>{{subscription.refill_count}} Original <span *ngIf="subscription.status!=='closed'">, {{subscription.refill_count-subscription.current_refill_count===0?'No ':subscription.refill_count-subscription.current_refill_count }} Refill Remaining</span></div>
                          </td>
                          <td>Every {{subscription.type==='default'?subscription.duration:subscription.custom_duration}} Days</td>
                          <td>{{subscription.subscription_price | currency:'INR'}}</td>
                          <td>
                                <span *ngIf="subscription.next_refill_date">{{subscription.next_refill_date | date: 'MM/dd/yyyy'}}</span>
                                <span *ngIf="!subscription.next_refill_date"> - </span>
                          </td>
                          <td>{{subscription.status}}</td>
                          <td>
                            <button type="button" *ngIf="subscription.status=='active'" (click)="deactivateSubscription(subscription)" class="btn btn-sm btn-danger"><i class="fa fa-ban mr-2"></i>Cancel Subscription</button>
                            <button type="button" *ngIf="subscription.status=='cancelled'" (click)="openModal(subscription,'ACTIVATE','RX')" class="btn btn-sm btn-success"><i class="fa fa-check mr-2"></i>Activate Subscription</button>
                            <button type="button" *ngIf="subscription.status=='active'"  class="btn btn-sm btn-primary" (click)="openModal(subscription,'CHANGE','RX')"><i class="fa fa-cog mr-2" aria-hidden="true"></i>Settings</button>
                          </td>
                        </tr>
                    </tbody>
                    <tfoot *ngIf="orderDetails.subscription_details.length==0">
                        <tr>
                            <td colspan="7">
                                <div class="text-center text-muted">
                                    <h2><i class="fa fa-info-circle"></i></h2>
                                    <h4>No Subscriptions for RxDrug !</h4>
                                </div>
                            </td>
                        </tr>
                    </tfoot>
                  </table>
            </div>

              <div class="table-responsive">
                  <table class="table">
                    <thead class="thead-light">
                        <tr>
                            <th>OTC Drug</th>
                            <th>Refill Duration</th>
                            <th>Amount To Charge</th>
                            <th>Next Refill Date</th>
                            <th>Subscription Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr  *ngFor="let subscription of orderDetails.otc_subscriptions">
                          <td>{{subscription.otc_drug_name}}</td>
                          <td>Every {{subscription.type==='default'?subscription.duration:subscription.custom_duration}} Days</td>
                          <td>{{subscription.subscription_price_total | currency:'INR'}}</td>
                          <td>
                                <span *ngIf="subscription.next_refill_date">{{subscription.next_refill_date | date: 'MM/dd/yyyy'}}</span>
                                <span *ngIf="!subscription.next_refill_date"> - </span>
                          </td>
                          <td>{{subscription.status}}</td>
                          <td>
                            <button type="button" *ngIf="subscription.status=='active'" (click)="deactivateOTCSubscription(subscription)" class="btn btn-sm btn-danger"><i class="fa fa-ban mr-2"></i>Cancel Subscription</button>
                            <button type="button" *ngIf="subscription.status=='cancelled'" (click)="openModal(subscription,'ACTIVATE','OTC')" class="btn btn-sm btn-success"><i class="fa fa-check mr-2"></i>Activate Subscription</button>
                            <button type="button" *ngIf="subscription.status=='active'"  class="btn btn-sm btn-primary" (click)="openModal(subscription,'CHANGE','OTC')"><i class="fa fa-cog mr-2" aria-hidden="true"></i>Settings</button>

                          </td>
                        </tr>
                    </tbody>
                    <tfoot *ngIf="orderDetails.otc_subscriptions.length==0">
                        <tr>
                            <td colspan="7">
                                <div class="text-center text-muted">
                                    <h2><i class="fa fa-info-circle"></i></h2>
                                    <h4>No Subscriptions for OTC Drug !</h4>
                                </div>
                            </td>
                        </tr>
                    </tfoot>
                  </table>
              </div>
        </div>
    </mat-tab>
    <mat-tab label="Logs">
         <app-order-logs></app-order-logs>
    </mat-tab>
</mat-tab-group>
<div class="form-group mt-1">
   <div class="text-center">
        <a routerLink="/admin/drug-order/list" routerLinkActive="active" class="btn btn-primary"><i class="fa fa-arrow-left mr-2" aria-hidden="true"></i>Back To Orders</a>
    </div>
</div>

<!--
<div mdbModal #addressModal="mdbModal" class="modal fade" id="addressModal" tabindex="-1" role="dialog" aria-labelledby="addressModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-primary modal-warning" role="document">
        <div class="modal-content text-center">
            <form [formGroup]="addressForm" (ngSubmit)="saveUserAddress(addressForm.valid,addressModal)">
            <div class="modal-header">
                <h5 class="modal-title">Change Order Shipping Address</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="closeAddressModal(addressModal)">
                        <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                            <div class="form-group">
                                <label class="float-left">Address Line 1:</label>
                                <input type="text" class="form-control" formControlName="address_line_1"  />
                                <div class="invalid-feedback" *ngIf="address_line_1.invalid && (address_line_1.dirty || address_line_1.touched)" class="text-danger">
                                    <div *ngIf="address_line_1.errors.required">Address Line 1 is required</div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="float-left">Address Line 2:</label>
                                <input type="text" class="form-control" formControlName="address_line_2" />
                            </div>


                    <div class="form-row">
                        <div class="col-md-6 col-12">
                            <div class="form-group">
                                <label class="float-left">City:</label>
                                <input type="text" class="form-control" formControlName="city_name" />
                                <div class="invalid-feedback" *ngIf="city_name.invalid && (city_name.dirty || city_name.touched)" class="text-danger">
                                    <div *ngIf="city_name.errors.required">city name is required</div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6 col-12">
                            <div class="form-group">
                                <label class="float-left">State:</label>
                                <select formControlName="state_id" class="form-control" (change)="setStateInfo($event.target.value)">
                                        <option *ngFor="let state of states" [value]="state.id">{{ state.name }}</option>
                                </select>
                                <div class="invalid-feedback" *ngIf="state_id.invalid && (state_id.dirty || state_id.touched)" class="text-danger">
                                    <div *ngIf="state_id.errors.required">state is required</div>
                                </div>
                            </div>
                        </div>

                         <div class="col-md-6 col-12">
                            <div class="form-group">
                                <label class="float-left">ZipCode:</label>
                                <input type="text" class="form-control" formControlName="zip_code"/>
                                <div class="invalid-feedback" *ngIf="zip_code.invalid && (zip_code.dirty || zip_code.touched)" class="text-danger">
                                    <div *ngIf="zip_code.errors.required">zipcode is required</div>
                                </div>
                            </div>
                         </div>
                    </div>

            </div>
            <div class="modal-footer justify-content-center">
                      <button class="btn btn-primary" [disabled]="addressForm.invalid" type="submit">Save Address</button>
            </div>
            </form>
        </div>
    </div>
</div>-->


<!--<div mdbModal #changeSubscriptionModal="mdbModal" id="changeSubscriptionModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="changeSubscriptionModal" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <form (ngSubmit)="changeSubscriptionSubmit(changeSubscriptionForm.valid,changeSubscriptionModal)" [formGroup]="changeSubscriptionForm" autocomplete="off">
                <div class="modal-header">
                    <button type="button" id="closechangeSubscriptionModalBtn" class="close pull-right" aria-label="Close" data-dismiss="modal" (click)="closeModal(changeSubscriptionModal)">
                        <span aria-hidden="true">×</span>
                    </button>
                    <h4 class="modal-title w-100" id="mychangeSubscriptionModalLabel">
                        {{ ModalLabel }}
                    </h4>
                </div>
                <div class="modal-body">
                   <p *ngIf="selectedSubscription">{{ selectedSubscription.medicine_name }}</p>
                     <input type="hidden" formControlName="subscription_id" />
                     <input type="hidden" formControlName="medicine_name" />
                    <div class="form-group">
                        <label class="form-label">Refill Duration</label>
                        <select name="customFrequency" class="form-control input-lg" formControlName="custom_duration">
                            <option *ngFor="let option of customFrequencyOptions" [value]="option.days">{{ option.title }} </option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer text-center">
                    <button type="submit" [disabled]="changeSubscriptionForm.invalid" class="btn btn-success">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
</div>-->


<!--
<div mdbModal #createRefillOrderModal="mdbModal" class="modal fade" id="createRefillOrderModal" tabindex="-1" role="dialog"
    aria-labelledby="createRefillOrderModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-warning" role="document" style="max-width:1240px;">
        <div class="modal-content text-center">
                <div class="modal-header">
                    <h5 class="modal-title">Create Refill Order</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"
                        (click)="closeCreateRefillOrderModal(createRefillOrderModal)">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" *ngIf="orderDetails">
                    <div class="row">
                        <div class="col-lg-6 col-md-6 col-12">
                            <div *ngIf="!loadingCreateRefillOrder">

                                    <div>
                                    <h6>Select Drug From Active Subscription</h6>
                                    <ul class="list-group list-group-flush" style="max-height:450px;overflow-y:scroll;">
                                        <li class="list-group-item d-flex justify-content-between align-items-center" *ngFor="let item of userSubscriptions">
                                            <div>{{ item.drug_name+' '+item.drug_dosage+' '+item.order_quantity+' '+item.drug_form}}
                                                <span *ngIf="item.product_type=='LENS'">{{ ' - '+item.eye_type }}</span>
                                            </div>
                                            <div>
                                                <div class="custom-control custom-checkbox">
                                                    <input type="checkbox" class="custom-control-input" id="{{'sub_'+item.id}}" (change)="handleChangeSubscription($event.target.checked,item,'RX')" [checked]="checkItemSelected(item.id,'RX')">
                                                    <label class="custom-control-label font-weight-normal" for="{{'sub_'+item.id}}">{{item.subscription_price| currency:'INR'}}</label>
                                                </div>
                                            </div>
                                        </li>
                                        <li class="list-group-item d-flex justify-content-between align-items-center" *ngFor="let item of userOTCSubscriptions">
                                            <div>{{ item.otc_drug_name}}
                                            </div>
                                            <div>
                                                <div class="custom-control custom-checkbox">
                                                    <input type="checkbox" class="custom-control-input" id="{{'otcsub_'+item.id}}" (change)="handleChangeSubscription($event.target.checked,item,'OTC')" [checked]="checkItemSelected(item.id,'OTC')">
                                                    <label class="custom-control-label font-weight-normal" for="{{'otcsub_'+item.id}}">{{item.subscription_price_total| currency:'INR'}}</label>
                                                </div>
                                            </div>
                                        </li>
                                    </ul>
                                    </div>
                            </div>
                            <div class="text-center my-auto" *ngIf="loadingCreateRefillOrder">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="sr-only">Loading...</span>
                                    </div>
                                    <p class="mt-3">Creating Order ...</p>
                            </div>
                        </div>
                        <div class="col-lg-6 col-md-6 col-12">
                                <h5>Order Summary</h5>
                                <table class="table table-sm" style="max-height:300px;overflow-y:scroll;">
                                    <thead class="thead-light">
                                        <tr>
                                            <th>Product</th>
                                            <th>Tax</th>
                                            <th>Price</th>
                                            <th>Line Total</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr *ngFor="let item of selectedSubscriptions">
                                            <td>
                                                <p class="mb-0 font-weight-normal">{{ item.drug_name+' '+item.drug_dosage+' '+item.order_quantity+' '+item.drug_form }}</p>
                                            </td>
                                            <td>
                                                <p class="mb-0 font-weight-normal">$0</p>
                                            </td>
                                            <td><p class="mb-0 font-weight-normal">{{item.subscription_price| currency:'INR'}}</p></td>
                                            <td>
                                                <p class="mb-0 font-weight-normal">{{item.subscription_price| currency:'INR'}}</p>
                                            </td>
                                        </tr>
                                        <tr *ngFor="let item of selectedOTCSubscriptions">
                                            <td>
                                                <p class="mb-0 font-weight-normal">{{ item.otc_drug_name }}</p>
                                            </td>
                                            <td>
                                                <p class="mb-0 font-weight-normal">{{item.subscription_tax| currency:'INR'}}</p>
                                            </td>
                                            <td><p class="mb-0 font-weight-normal">{{item.subscription_price| currency:'INR'}}</p></td>
                                            <td>
                                                <p class="mb-0 font-weight-normal">{{item.subscription_price_total| currency:'INR'}}</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                    <tfoot>
                                        <tr>
                                            <td colspan="4">
                                                <p class="mb-0 font-weight-bold text-right">Total : {{ refillOrderTotal| currency:'INR' }}</p>
                                            </td>
                                        </tr>
                                    </tfoot>
                                </table>
                        </div>
                    </div>
                </div>
                <div class="modal-footer justify-content-center" *ngIf="(selectedSubscriptions.length>0 || selectedOTCSubscriptions.length>0) && !loadingCreateRefillOrder">
                    <button class="btn btn-primary" type="button" (click)="handleSubmitCreateRefillOrderForm(createRefillOrderModal)">Create Order</button>
                </div>
        </div>
    </div>
</div>-->
